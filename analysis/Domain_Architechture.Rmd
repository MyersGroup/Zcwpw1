---
title: "Domain Architechture"
output: html_notebook
---


```{r, fig.width=10}

pkgload::load_all("~/Dropbox/Github/drawProteins/")

rel_json <- drawProteins::get_features("Q9H0M4 Q6IR42") # H2RBY7 E2RFJ2 F7DK93 A0A3S5ZP38 G1PE65
rel_data <- drawProteins::feature_to_dataframe(rel_json)

rel_data[which(rel_data$type=="COILED"),]$description <- "Coiled Coil"

rel_data <- rbind(rel_data, data.frame(type="DOMAIN2", description="SCP-1 ?", begin=76, end=228, length=228-76+1, accession="Q6IR42", entryName="ZCPW1_MOUSE", taxid=10090, order=1))
rownames(rel_data[nrow(rel_data),]) <- "featuresTemp.23"
draw_domains2 <- function(p,
                        data = data,
                        label_domains = TRUE,
                        label_size = 4,
                        show.legend = TRUE,
                        type = "DOMAIN2"){
    begin=end=description=NULL
    p <- p + ggplot2::geom_rect(data= data[data$type == type,],
            mapping=ggplot2::aes(xmin=begin,
                        xmax=end,
                        ymin=order-0.25,
                        ymax=order+0.25,
                        fill=description),
                        show.legend = show.legend, alpha=0.5)

    if(label_domains == TRUE){
        p <- p + ggplot2::geom_label(data = data[data$type == type, ],
                        ggplot2::aes(x = begin + (end-begin)/2,
                            y = order,
                            label = description),
                            size = label_size)
    }

    return(p)
}

rel_data[rel_data$order==1,]$order <- 4
rel_data[rel_data$order==2,]$order <- 3

rel_data[rel_data$order==4,]$order <- 2
rel_data[rel_data$order==3,]$order <- 1

p <- draw_canvas(rel_data)
p <- draw_chains(p, rel_data, label_chains = F)
p <- draw_domains(p, rel_data)
p <- draw_domains2(p, rel_data)
p <- draw_domains(p, rel_data, type="ZN_FING")
p <- draw_domains(p, rel_data, type="COILED")
p <- p + scale_y_continuous(breaks=seq_along(unique(rel_data$entryName)), labels = c("Human","Mouse")) + xlim(0,NA)
p <- p + theme_bw(base_size = 20) + # white background
    theme(panel.grid.minor=element_blank(), 
        panel.grid.major=element_blank()) +
    theme(axis.ticks = element_blank(), 
        ) + #axis.text.y = element_blank()
    theme(panel.border = element_blank()) +
  scale_fill_brewer(palette = "Set1")

pdf("../results/Zcwpw1_domain_architechture.pdf", width = 10, height = 5)
p + theme(legend.position = "none")
dev.off()


rel_json <- drawProteins::get_features("Q9NQV7 Q96EQ9")
rel_data <- drawProteins::feature_to_dataframe(rel_json)

rel_data$description <- gsub(";.+$", "", rel_data$description, perl = T)
rel_data$description <- gsub(" [0-9]+$", "", rel_data$description, perl = T)

p <- draw_canvas(rel_data)
p <- draw_chains(p, rel_data, label_chains = F)
p <- draw_domains(p, rel_data)
p <- draw_domains(p, rel_data, type="ZN_FING", label_domains = F)
p <- p + scale_y_continuous(breaks=seq_along(unique(rel_data$entryName)), labels = unique(rel_data$entryName)) + xlim(0,NA)
p <- p + theme_bw(base_size = 20) + # white background
    theme(panel.grid.minor=element_blank(), 
        panel.grid.major=element_blank()) +
    theme(axis.ticks = element_blank(), 
        ) + #axis.text.y = element_blank()
    theme(panel.border = element_blank()) +
  scale_fill_brewer(palette = "Set1")

pdf("../results/Prdm9_domain_architechture.pdf", width = 10, height = 5)
p + theme(legend.position = "bottom") + labs(fill = "Feature")
dev.off()

# 
# draw_protein <- function(ac="P07683"){
#   rel_json <- drawProteins::get_features(ac)
#     
#   rel_data <- drawProteins::feature_to_dataframe(rel_json)
#   p <- draw_canvas(rel_data)
#   p <- draw_chains(p, rel_data)
#   return(p)
# 
# }
# 
# draw_protein()

```
